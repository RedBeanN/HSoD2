extends layout

block content
  link(rel="stylesheet", href="/m/css/mdui.min.css")
  link(rel="stylesheet", href="/m/css/mdui-layout.css")
  link(rel="stylesheet", href="/m/css/illustratev2.css")
  script(src="/m/js/mdui.min.js")
  script(src="/javascripts/vue.min.js")
  script(src="/javascripts/axios.min.js")
  #app
    .mdui-appbar.mdui-appbar-fixed.mdui-app-bar-scroll-hide
      .mdui-toolbar.mdui-color-theme
        a.mdui-btn.mdui-btn-icon.mdui-ripple.mdui-ripple-white(href='/')
          i.mdui-icon.material-icons home
        .mdui-typo-title 装备图鉴(Beta)
        .mdui-toolbar-spacer
        #search.mdui-textfield.mdui-textfield-expandable.mdui-float-right
          button.mdui-textfield-icon.mdui-btn.mdui-btn-icon
            i.mdui-icon.material-icons search
          input.mdui-textfield-input.mdui-text-color-white(type='text', placeholder="搜索", v-model='searchInput')
          button.mdui-textfield-close.mdui-btn.mdui-btn-icon(@click='searchInput=""')
            i.mdui-icon.material-icons close
        img(src='/images/favicon-r.png')
      .mdui-tab.mdui-color-theme
        a.type.type-all.mdui-ripple.mdui-tab-active( @click='selectTab("all", $event)') 全部
        a.type.mdui-ripple(
          v-for='(value, key) in tabs',
          @click='selectTab(key, $event)'
        ) {{ value }}
    #container.mdui-card.mdui-container.mdui-m-y-4.hide
      .mdui-row
        a.item.mdui-ripple.mdui-col-xs-6.mdui-col-sm-4.mdui-col-md-3.mdui-col-lg-2.mdui-p-a-1.mdui-p-x-2.mdui-valign(
          v-for='item in itemsInPage',
          @click='showEquipDetail(item.uid, item.title, item.type)'
        )
          img.equip-img.mdui-m-r-1(
            :src='"https://static.image.mihoyo.com/hsod2_webview/images/broadcast_top/equip_icon/png/" + (item.img < 1000 ? ("000" + item.img).slice(-3) : item.img) + ".png"',
            @error='errorImg',
          )
          p.item-title {{ item.title }}
            br
            img.star(src='../images/star-full.png', v-for='i in parseInt(item.rarity)')
      .mdui-row.mdui-p-y-1.mdui-velign.mdui-text-right
        p.mdui-float-right.mdui-col-xs-12.mdui-col-sm-5.mdui-p-b-1
          | 每页 
          input#item-per-page.mdui-textfield-input(type="number", v-model.number='current.itemPerPage')
          |  条 | 
          | 跳转到 
          select.mdui-select(v-model='current.page')
            option(v-for='i in totalPages', :value='i') {{ i }}
        p.paging.mdui-float-right.mdui-col-xs-12.mdui-col-sm-7.mdui-velign.mdui-text-center
          a.mdui-btn.mdui-ripple.mdui-p-a-1(@click='paging("first")', :disabled='current.page == 1')
            i.mdui-icon.material-icons skip_previous
          a.mdui-btn.mdui-ripple.mdui-p-a-1(@click='paging("pre")', :disabled='current.page == 1')
            i.mdui-icon.material-icons navigate_before
          a.mdui-btn.mdui-ripple.mdui-p-a-1(
            v-for='page in pages',
            :class='{selected: page == current.page, disabled: page == "..."}',
            :disabled='page == current.page || page == "..."',
            @click='paging(page)'
          ) {{ page }}
          a.mdui-btn.mdui-ripple.mdui-p-a-1(@click='paging("next")', :disabled='current.page == totalPages')
            i.mdui-icon.material-icons navigate_next
          a.mdui-btn.mdui-ripple.mdui-p-a-1(@click='paging("last")', :disabled='current.page == totalPages')
            i.mdui-icon.material-icons skip_next
    .mdui-dialog#dialog
      .mdui-dialog-title
        .mdui-dialog-title-header {{ equip.title ? ("图鉴详情: " + equip.title) : "发生错误"}}
      #dialog-content.mdui-dialog-content
        .mdui-container-fluid
          template(v-for='(val, key) in equip', v-if='key.includes("prop") || key.includes("kill")')
            .equip-detail.mdui-col-xs-12.mdui-m-t-1
              p.title.green {{ val.title }}
              p.desc(v-if='showDetail') {{ formatDesc(val.desc) }}
              p.maxlv-desc(v-else) {{ formatDesc(val.maxLvDesc) }}
          template(v-else-if='key === "img"')
            .mdui-col-xs-2.main-img
              img.equip-img(
                :src='"https://static.image.mihoyo.com/hsod2_webview/images/broadcast_top/equip_icon/png/" + (val < 1000 ? ("000" + val).slice(-3) : val) + ".png"',
                @error='errorImg',
              )
          template(v-else-if='mainProp.includes(key)')
            p.mdui-col-xs-10.main.green
              span {{ val }}
          template(v-else-if='key.includes("Base") || key.includes("Add")')
            p.mdui-col-xs-6.mdui-col-sm-4(v-if='showDetail && val !== "" && val != "0"') {{ keyMap[key] || key }} ： 
              span {{ val }}
          template(v-else-if='key === "posterId"')
            .mdui-col-xs-12.awaken-img-container.mdui-m-t-1(v-if='val !== "" && val != "0"')
              img.awaken-img(
                :src='"../images/awaken/" + (1000 + parseInt(val)) + ".png"',
                @error='errorAwakenImg(val, $event)'
              )
          template(v-else)
            p.mdui-col-xs-6.mdui-col-sm-4(v-if='val !== "" && val !== "0"') {{ keyMap[key] || key }} : 
              span {{ val }}
      .mdui-dialog-actions
        label.mdui-checkbox(for='toggleDetail')
          input(
            type='checkbox',
            id='toggleDetail',
            :value='showDetail',
            v-model='showDetail'
          )
          i.mdui-checkbox-icon
          | 显示细节
        button.mdui-btn.mdui-ripple(mdui-dialog-close)
          i.mdui-icon.material-icons close
  script(src="/m/js/illustratev2.js")
