<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Home - Node-mirai-sdk DOC</title>
    
    <meta name="description" content="node-mirai-sdk" />
    
        <meta name="keywords" content="mirai qq bot" />
        <meta name="keyword" content="mirai qq bot" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/mamoe/mirai" target="_blank" class="menu-item" id="mirai_link" >mirai</a></h2><h2><a href="https://github.com/mamoe/mirai-api-http" target="_blank" class="menu-item" id="mirai_api_http_link" >mirai-api-http</a></h2><h2><a href="https://github.com/RedBeanN/node-mirai" target="_blank" class="menu-item" id="node_mirai_sdk_link" >node-mirai-sdk</a></h2><h3>Classes</h3><ul><li><a href="NodeMirai.html">NodeMirai</a><ul class='methods'><li data-type='method'><a href="NodeMirai.html#sendFriendMessage">sendFriendMessage</a></li><li data-type='method'><a href="NodeMirai.html#sendGroupMessage">sendGroupMessage</a></li><li data-type='method'><a href="NodeMirai.html#sendTempMessage">sendTempMessage</a></li><li data-type='method'><a href="NodeMirai.html#sendImageMessage">sendImageMessage</a></li><li data-type='method'><a href="NodeMirai.html#sendVoiceMessage">sendVoiceMessage</a></li><li data-type='method'><a href="NodeMirai.html#sendFlashImageMessage">sendFlashImageMessage</a></li><li data-type='method'><a href="NodeMirai.html#uploadImage">uploadImage</a></li><li data-type='method'><a href="NodeMirai.html#uploadVoice">uploadVoice</a></li><li data-type='method'><a href="NodeMirai.html#sendMessage">sendMessage</a></li><li data-type='method'><a href="NodeMirai.html#sendQuotedFriendMessage">sendQuotedFriendMessage</a></li><li data-type='method'><a href="NodeMirai.html#sendQuotedGroupMessage">sendQuotedGroupMessage</a></li><li data-type='method'><a href="NodeMirai.html#sendQuotedTempMessage">sendQuotedTempMessage</a></li><li data-type='method'><a href="NodeMirai.html#sendQuotedMessage">sendQuotedMessage</a></li><li data-type='method'><a href="NodeMirai.html#sendNudge">sendNudge</a></li><li data-type='method'><a href="NodeMirai.html#reply">reply</a></li><li data-type='method'><a href="NodeMirai.html#quoteReply">quoteReply</a></li><li data-type='method'><a href="NodeMirai.html#recall">recall</a></li><li data-type='method'><a href="NodeMirai.html#getFriendList">getFriendList</a></li><li data-type='method'><a href="NodeMirai.html#getGroupList">getGroupList</a></li><li data-type='method'><a href="NodeMirai.html#getBotProfile">getBotProfile</a></li><li data-type='method'><a href="NodeMirai.html#getFriendProfile">getFriendProfile</a></li><li data-type='method'><a href="NodeMirai.html#getGroupMemberProfile">getGroupMemberProfile</a></li><li data-type='method'><a href="NodeMirai.html#getMessageById">getMessageById</a></li><li data-type='method'><a href="NodeMirai.html#getGroupMemberList">getGroupMemberList</a></li><li data-type='method'><a href="NodeMirai.html#setGroupMute">setGroupMute</a></li><li data-type='method'><a href="NodeMirai.html#setGroupUnmute">setGroupUnmute</a></li><li data-type='method'><a href="NodeMirai.html#setGroupMuteAll">setGroupMuteAll</a></li><li data-type='method'><a href="NodeMirai.html#setGroupUnmuteAll">setGroupUnmuteAll</a></li><li data-type='method'><a href="NodeMirai.html#setGroupKick">setGroupKick</a></li><li data-type='method'><a href="NodeMirai.html#setGroupConfig">setGroupConfig</a></li><li data-type='method'><a href="NodeMirai.html#setEssence">setEssence</a></li><li data-type='method'><a href="NodeMirai.html#getGroupConfig">getGroupConfig</a></li><li data-type='method'><a href="NodeMirai.html#setGroupMemberInfo">setGroupMemberInfo</a></li><li data-type='method'><a href="NodeMirai.html#getGroupMemberInfo">getGroupMemberInfo</a></li><li data-type='method'><a href="NodeMirai.html#quit">quit</a></li><li data-type='method'><a href="NodeMirai.html#handleMemberJoinRequest">handleMemberJoinRequest</a></li><li data-type='method'><a href="NodeMirai.html#handleBotInvitedJoinGroupRequest">handleBotInvitedJoinGroupRequest</a></li><li data-type='method'><a href="NodeMirai.html#handleNewFriendRequest">handleNewFriendRequest</a></li><li data-type='method'><a href="NodeMirai.html#uploadFileAndSend">uploadFileAndSend</a></li><li data-type='method'><a href="NodeMirai.html#getGroupFileList">getGroupFileList</a></li><li data-type='method'><a href="NodeMirai.html#getGroupFileInfo">getGroupFileInfo</a></li><li data-type='method'><a href="NodeMirai.html#renameGroupFile">renameGroupFile</a></li><li data-type='method'><a href="NodeMirai.html#moveGroupFile">moveGroupFile</a></li><li data-type='method'><a href="NodeMirai.html#makeDir">makeDir</a></li><li data-type='method'><a href="NodeMirai.html#deleteGroupFile">deleteGroupFile</a></li><li data-type='method'><a href="NodeMirai.html#deleteFriend">deleteFriend</a></li><li data-type='method'><a href="NodeMirai.html#registerCommand">registerCommand</a></li><li data-type='method'><a href="NodeMirai.html#sendCommand">sendCommand</a></li><li data-type='method'><a href="NodeMirai.html#on">on</a></li><li data-type='method'><a href="NodeMirai.html#onSignal">onSignal</a></li><li data-type='method'><a href="NodeMirai.html#onMessage">onMessage</a></li><li data-type='method'><a href="NodeMirai.html#onEvent">onEvent</a></li><li data-type='method'><a href="NodeMirai.html#listen">listen</a></li><li data-type='method'><a href="NodeMirai.html#use">use</a></li></ul></li></ul><h3>Namespaces</h3><ul><li></li></ul><h3>Global</h3><ul><li><a href="global.html#WebSocket">WebSocket</a></li><li><a href="global.html#getBotList">getBotList</a></li><li><a href="global.html#auth">auth</a></li><li><a href="global.html#verify">verify</a></li><li><a href="global.html#release">release</a></li><li><a href="global.html#fetchMessage">fetchMessage</a></li><li><a href="global.html#getRoamingMessages">getRoamingMessages</a></li></ul>
</nav>

<div id="main">
    

    



    


    <section class="package">
        <h3> </h3>		
    </section>









    



    <section class="readme usertext">
        <article><h1>node-mirai</h1>
<p><a href="https://www.npmjs.com/package/node-mirai-sdk"><img src="https://img.shields.io/npm/v/node-mirai-sdk" alt="NPM Version"></a></p>
<p><a href="https://github.com/mamoe/mirai">mirai</a> 的 Node.js SDK.</p>
<p>由于还在开发中, 所有 API 均为待定.</p>
<p>最低支持:</p>
<ul>
<li><code>mirai-core-2.6.2</code></li>
<li><code>mirai-api-http-2.0.0</code> (部分兼容 <code>1.x</code>)</li>
</ul>
<h2>QuickStart / 快速开始</h2>
<ul>
<li>运行你的 <a href="https://github.com/project-mirai/mirai-api-http">mirai-api-http</a> service</li>
<li>安装 <a href="https://www.npmjs.com/package/node-mirai-sdk">node-mirai-sdk</a></li>
</ul>
<pre class="prettyprint source lang-bash"><code># for mirai-api-http 2.x
npm i -S node-mirai-sdk@latest
# for mirai-api-http 1.x
npm i -S node-mirai-sdk@0.2.4
</code></pre>
<ul>
<li>编写代码 (main.js)</li>
</ul>
<p><em>PS: 注释中带 * 为必须有。</em></p>
<pre class="prettyprint source lang-javascript"><code>// es5 CommonJS
const Mirai = require('node-mirai-sdk');
// es6 module or typescript
import * as Mirai from 'node-mirai-sdk';
// typescript with `esModuleInterop: true`
import Mirai from 'node-mirai-sdk';

const { Plain, At } = Mirai.MessageComponent;

/**
* 服务端设置(*)
* host: mirai-api-http 的地址和端口，默认是 http://127.0.0.1:8080
* verifyKey: mirai-api-http 的 verifyKey，建议手动指定
* qq: 当前 BOT 对应的 QQ 号
* enableWebsocket: 是否开启 WebSocket，需要和 mirai-api-http 的设置一致
* wsOnly: 使用 WebSocket 发送数据
*/
const bot = new Mirai({
  host: 'http://hostname:port',
  // mirai-api-http-2.x
  verifyKey: 'YourVerifyKey',
  // mirai-api-http-1.x
  authKey: 'YourAuthKey',
  qq: 123456,
  enableWebsocket: false,
  wsOnly: false, // 由于 WebSocket Adapter 不支持发送文件，部分功能仍需使用 HTTP Adapter
});

// auth 认证(*)
bot.onSignal('authed', () => {
  console.log(`Authed with session key ${bot.sessionKey}`);
  bot.verify();
});

// session 校验回调
bot.onSignal('verified', async () => {
  console.log(`Verified with session key ${bot.sessionKey}`);

  // 获取好友列表，需要等待 session 校验之后 (verified) 才能调用 SDK 中的主动接口
  const friendList = await bot.getFriendList();
  console.log(`There are ${friendList.length} friends in bot`);
});

// 接受消息,发送消息(*)
bot.onMessage(async message => {
  const { type, sender, messageChain, reply, quoteReply } = message;
  let msg = '';
  messageChain.forEach(chain => {
    if (chain.type === 'Plain')
        msg += Plain.value(chain);                  // 从 messageChain 中提取文字内容
  });

  // 直接回复
  if (msg.includes('收到了吗'))
    reply('收到了收到了');                          // 或者: bot.reply('收到了收到了', message)
  // 引用回复
  else if (msg.includes('引用我'))
    quoteReply([At(sender.id), Plain('好的')]);     // 或者: bot.quoteReply(messageChain, message)
  // 撤回消息
  else if (msg.includes('撤回'))
    bot.recall(message, sender.group.id);           // 私聊为 sender.id
  // 发送图片，参数接受图片路径或 Buffer
  else if (msg.includes('来张图'))
    bot.sendImageMessage(&quot;./image.jpg&quot;, message);
});

/* 开始监听消息(*)
 * 'all' - 监听好友和群
 * 'friend' - 只监听好友
 * 'group' - 只监听群
 * 'temp' - 只监听临时会话
*/
bot.listen('all'); // 相当于 bot.listen('friend', 'group', 'temp')

// 退出前向 mirai-http-api 发送释放指令(*)
process.on('exit', () => {
  bot.release();
});
</code></pre>
<ul>
<li>运行 BOT</li>
</ul>
<pre class="prettyprint source lang-bash"><code>node main.js
</code></pre>
<h2>高级用法</h2>
<p>另请参考</p>
<ul>
<li><a href="https://github.com/RedBeanN/node-mirai/blob/master/event.md">事件订阅说明</a></li>
<li><a href="https://redbean.tech/node-mirai-sdk">API文档</a></li>
</ul>
<pre class="prettyprint source lang-javascript"><code>const Mirai = require('node-mirai-sdk');
const { Plain, At, FlashImage, Image, Face, AtAll, Xml, Json, App, Poke, Forward } = Mirai.MessageComponent;
const { Friend, Group } = Mirai.Target
const { serialize, deserialize } = Mirai.MessageComponent;

// ...

bot.onMessage(async message => {
  const { type, sender, messageChain, reply, quoteReply, recall } = message; //接受其他消息,进行提取关键消息

  // 遍历消息链提取文本内容
  let msg = '';
  messageChain.forEach(chain => {
    if (chain.type === 'Plain') msg += Plain.value(chain); //判断消息类型是不是文字
  });

  // 将消息链序列化为含 mirai 码的字符串
  // 返回内容类似: 文字123[mirai:at:12345]文字234[mirai:image:{abcd}.png]文字345
  const serialized = serialize(messageChain0);

  // 把序列化后的字符串解析为 messageChain
  // [{ type: 'Plain', text: '文字123' }, { type: 'At', target: 12345, display: '' }, ...]
  const deserialized = deserialize(serialized);

  switch (msg) {
    case &quot;文字测试&quot;:
      // 回复文字, 第一个参数可以是字符串或消息链, 第二个参数为原始消息或 `Mirai.Target` 构造的对象
      bot.reply('文字测试', message);
      bot.reply([Plain('文字测试')], Friend(123456))
      // 可以使用从 `message` 解构的 `reply` 方法, 无需传入原始消息
      reply('文字测试'); // message.reply('文字测试')
      break;
    
    case &quot;撤回测试&quot;:
      // 撤回指定的消息
      // 从 MAH 2.6.0 开始, 如果`message`不带有`sender`信息则需传入原始 QQ 或群号
      // 撤回其他群员的消息需要 bot 有管理权限, 管理员不能撤回群主的消息
      bot.recall(message, sender.group.id);
      // 可以使用从 `message` 解构的 `recall` 方法, 无需传入原始消息
      recall(); // message.recall()
      break;
    // 或者
    case &quot;撤回测试2&quot;:
      // 发送消息的接口返回值均提供 `recall` 方法以供撤回, 无需传入原始 QQ 或群号
      const res = await reply('这条消息将被撤回'); // bot.recall(res) throws error!
      setTimeout(() => res.recall(), 2000);
      break;

    case &quot;图片测试&quot;:
      bot.reply([
        Image({
          url: 'https://i2.hdslb.com/bfs/archive/68662ffb133c15232d4c7e763c43e07bccc98ccb.jpg'
        })
      ], message); // 回复图片
      break;

    case &quot;表情测试&quot;:
      bot.reply([Face(123)], message); // 回复表情
      break;

    case &quot;闪照测试&quot;:
      bot.reply([
        FlashImage({
          url:'https://i2.hdslb.com/bfs/archive/68662ffb133c15232d4c7e763c43e07bccc98ccb.jpg'
        })
      ], message); // 回复闪照
      break;

    case &quot;引用测试&quot;:
      bot.quoteReply([Plain('引用测试')], message); // 引用消息
      break;
    
    case &quot;@测试&quot;:
      bot.reply([At(sender.id)], message); // @测试
      break;

    case &quot;全体@测试&quot;:
      bot.reply([AtAll()], message); // 全体@测试&quot;
      break;

    case &quot;戳一戳测试&quot;:
      bot.reply([Poke('Poke')], message); // 戳一戳
      break;

    case &quot;转发测试&quot;:
      const forwardMessage = [Forward([
        message, // 可以直接转发消息本体
        message.messageChain.find(c => c.type === 'Source').id, // 也可以引用源消息ID
        {
          senderId: 10001, // QQ号
          senderName: 'Pony', // 显示名称
          time: Math.floor(Date.now() / 1000), // 时间戳以秒为单位
          messageChain: [Plain('用_创造快乐')]
        } // 或者自行构建消息列表
      ])]; // 三者可以混合使用
      reply(forwardMessage); // 转发消息
      break;

    case &quot;全体禁言测试&quot;:
      bot.setGroupMuteAll(sender.group.id, message); // 全体禁言
      break;
      
    case &quot;全体禁言取消测试&quot;:
      bot.setGroupUnmuteAll(sender.group.id, message); // 全体禁言取消
      break;
    
    case &quot;禁言群员测试&quot;:
      bot.setGroupMute(sender.group.id,sender.id); // 禁言群成员10分钟
      break;

    case &quot;解除禁言群员测试&quot;:
      bot.setGroupUnmute(sender.group.id,sender.id); // 解除群成员禁言
      break;
    
    case &quot;移除群成员测试&quot;:
      bot.setGroupKick(sender.group.id,sender.id); // 移除群成员
      break;
    
    case &quot;发布群公告测试&quot;:
      bot.setGroupConfig(sender.group.id, {
        announcement:'这是一个测试公告'
      }); // 发布群公告
      break;

    case &quot;修改群员资料测试&quot;:
      bot.setGroupMemberInfo(sender.group.id, sender.id, {
        name: '测试'
      });   // 修改群员资料
      break;
  }
});

</code></pre>
<h2>TypeScript 支持(实验性)</h2>
<p><code>types/index.d.ts</code> 为 <code>tsc</code> 自动生成, 部分枚举类型可通过 <code>node-mirai-sdk/type</code> 引入</p>
<pre class="prettyprint source lang-typescript"><code>import { events, Permission } from 'node-mirai-sdk/type'
// ...
bot.onEvent(events.groupPermissionChange, (event) => {
  if (event.Permission === Permission.MEMBER) {
    // do something
  }
})

</code></pre>
<h2>使用 <code>target</code> 构造</h2>
<p>(由 <a href="https://github.com/kirainmoe">@kirainmoe</a> 提供)</p>
<p><code>Bot</code> 主动调用部分接口, 需要按照消息的格式, 构造发送对象 <code>target</code>:</p>
<pre class="prettyprint source lang-javascript"><code>// 私聊发送图片给 12345678
bot.sendImageMessage(url, { type: 'FriendMessage', sender: { id: 12345678 } });
// 群聊发送图片到 998244353
bot.sendImageMessage(url, { type: 'FriendMessage', sender: { group:  { id: 998244353 } } });

</code></pre>
<p>通过从 NodeMirai.Target 引入 Friend, Group 或 Temp 可以省去构造 target 的过程:</p>
<pre class="prettyprint source lang-javascript"><code>const { Friend, Group, Temp } = require(&quot;node-mirai-sdk&quot;).Target;
bot.sendImageMessage(url, Friend(12345678));
bot.sendImageMessage(url, Group(998244353));
bot.sendImageMessage(url, Temp(998244353, 12345678));               // 给群号为 998244353 的用户 12345678 发送临时消息图片

</code></pre></article>
    </section>






    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a> on Sat Dec 10 2022 00:26:13 GMT+0800 (香港标准时间) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>