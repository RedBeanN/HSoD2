'use strict';var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step('next',value)},function(err){step('throw',err)})}}return step('next')})}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}(function(){var $$=mdui.JQ;$$('#back-to-index').remove();$$('body').removeClass('mdui-drawer-body-left');var app=new Vue({el:'#app',data:{cards:[],versions:[],types:['\u5168\u90E8','\u88C5\u5907','\u5E38\u89C4','\u6D3B\u52A8','\u62A5\u9519','\u517C\u5BB9','\u610F\u89C1'],searchInput:'',typeInput:'',color:{'\u672A\u5904\u7406':{color:'#1E40FE'},'\u5DF2\u5904\u7406':{color:'#46CB47'},'\u8FDB\u884C\u4E2D':{color:'#B212CE'},'\u4E0D\u5904\u7406':{color:'red'}},statusMap:{'1':'\u672A\u5904\u7406','2':'\u4E0D\u5904\u7406','3':'\u5DF2\u5904\u7406','4':'\u8FDB\u884C\u4E2D'},tagMap:{'1':'\u88C5\u5907','2':'\u6D3B\u52A8','3':'\u610F\u89C1','4':'\u5E38\u89C4','5':'\u62A5\u9519','6':'\u517C\u5BB9','33':'\u6D3B\u52A8'},current:{status:'status',title:'title',subtitle:'subtitle',content:'content',id:'id',detail:'<pre></pre>',images:[]},currentBtn:'\u5E72\u6389\u7E41\u4F53\u5B57!',disableT2s:false},computed:{filteredCards:function filteredCards(){var _this=this;this.cards.sort(function(a,b){return b.id-a.id});return this.cards.filter(function(item){if(item.title&&item.title.indexOf(_this.typeInput)===-1)return false;for(var i in item){if(item[i].indexOf(_this.searchInput)!==-1)return true}return false})}},methods:{loadVersions:function loadVersions(){var self=this;return new Promise(function(resolve,reject){axios.get('http://47.100.20.145:443/buglist/list').then(function(res){var vers=[];if(res&&res.data)vers=res.data.map(function(i){return i.name});self.versions=[].concat(_toConsumableArray(vers));resolve(vers)})})},loadList:function loadList(v,e){var self=this;v=v==='\u5168\u90E8'?'':v;showLoading();$$('.mdui-tab-active.version-select').removeClass('mdui-tab-active');$$(e.target).addClass('mdui-tab-active');axios.get('http://47.100.20.145:443/buglist/'+v).then(function(res){self.parseData(res.data,v);self.backToTop();hideLoading()})},filterType:function filterType(t,e){this.typeInput=t==='\u5168\u90E8'?'':t;$$('.mdui-tab-active.type-select').removeClass('mdui-tab-active');$$(e.target).addClass('mdui-tab-active');this.backToTop()},parseData:function parseData(data,v){var _this2=this;var arr=[];if(v===''){for(var i in data){var _arr;(_arr=arr).push.apply(_arr,_toConsumableArray(data[i]))}arr=arr.reverse()}else arr=data;this.cards=arr.map(function(item){return{status:_this2.statusMap[item.status],title:_this2.tagMap[item.type]||'\u5E38\u89C4',subtitle:'['+item.version+'] '+item.startdate,content:item.title,id:item.id,detail:item.content,images:item.images}})},getT2S:function getT2S(text){return axios.get(encodeURI('/convert/t2s?text='+text.replace(/&nbsp;/,' ').replace(/\+/g,'^plus^')))},t2s:function t2s(cid,content,e){showLoading();$$(e.target).text('\u6B63\u5728\u5E72\u6389...');axios.get(encodeURI('/convert/t2s?text='+content.replace(/\+/g,'^plus^'))).then(function(res){$$('#card-'+cid).text(res.data.replace(/\^plus\^/g,'+'));$$(e.target).text('\u5E72\u6389\u5566 !').attr('disabled','')}).catch(function(_){$$(e.target).text('\u5931\u8D25\u4E86...');setTimeout(function(){$$(e.target).text('\u518D\u6765\u4E00\u6B21 ?')},1000)}).then(function(_){hideLoading()})},t2sCurrent:function t2sCurrent(){var _this3=this;this.currentBtn='\u6B63\u5728\u5E72\u6389...';this.getT2S(this.current.content).then(function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(content){var results,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,r,res;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this3.current.content=content.data.replace(/\^plus\^/g,'+');if(!(!_this3.current.detail||_this3.current.detail.length===0)){_context.next=3;break}return _context.abrupt('return');case 3:results=_this3.current.detail.match(/<p>[\s\S]*?<\/p>/g);if(!(results===null)){_context.next=6;break}return _context.abrupt('return');case 6:_iteratorNormalCompletion=true;_didIteratorError=false;_iteratorError=undefined;_context.prev=9;_iterator=results[Symbol.iterator]();case 11:if(_iteratorNormalCompletion=(_step=_iterator.next()).done){_context.next=22;break}r=_step.value;if(!r.includes('img')){_context.next=15;break}return _context.abrupt('continue',19);case 15:_context.next=17;return _this3.getT2S(r);case 17:res=_context.sent;_this3.current.detail=_this3.current.detail.replace(r,res.data).replace(/\^plus\^/g,'+');case 19:_iteratorNormalCompletion=true;_context.next=11;break;case 22:_context.next=28;break;case 24:_context.prev=24;_context.t0=_context['catch'](9);_didIteratorError=true;_iteratorError=_context.t0;case 28:_context.prev=28;_context.prev=29;if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}case 31:_context.prev=31;if(!_didIteratorError){_context.next=34;break}throw _iteratorError;case 34:return _context.finish(31);case 35:return _context.finish(28);case 36:case'end':return _context.stop();}}},_callee,_this3,[[9,24,28,36],[29,,31,35]])}));return function(_x){return _ref.apply(this,arguments)}}()).then(function(){_this3.currentBtn='\u5E72\u6389\u5566!';_this3.disableT2s=true}).catch(function(){_this3.currentBtn='\u5931\u8D25\u4E86...';var self=_this3;setTimeout(function(){self.currentBtn='\u518D\u6765\u4E00\u6B21?'},1000)})},showDetail:function showDetail(c){this.currentBtn='\u5E72\u6389\u7E41\u4F53\u5B57!';this.disableT2s=false;this.$set(this,'current',_extends({},c));this.$nextTick(function(){new mdui.Dialog('#detail-dialog',{history:false}).open()})},backToTop:function backToTop(){document.body.scrollTop=0;document.documentElement.scrollTop=0}},created:function created(){var self=this;this.loadVersions().then(function(ver){self.loadList(ver[0],{target:$$('.version-select')[0]});self.filterType(self.types[0],{target:$$('.type-select')[0]})})},mounted:function mounted(){mdui.mutation();$$('.cards').css('display','block')}});function showLoading(){$$('#progress').css('opacity',1)}function hideLoading(){$$('#progress').css('opacity',0)}})();