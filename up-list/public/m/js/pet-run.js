'use strict';function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step('next',value)},function(err){step('throw',err)})}}return step('next')})}}(function(doc,win){var docEl=doc.documentElement;var maxWidth=768;var resizeEvt='orientationchange'in window?'orientationchange':'resize';var recalc=function recalc(){settings.scale=1;var clientWidth=docEl.clientWidth;if(!clientWidth)return;if(clientWidth>maxWidth)clientWidth=maxWidth;if(clientWidth<=maxWidth)settings.scale=clientWidth/640;docEl.style.fontSize=clientWidth*0.95+'px'};if(!doc.addEventListener)return;win.addEventListener(resizeEvt,recalc,false);doc.addEventListener('DOMContentLoaded',recalc,false)})(document,window);var BSearch=function BSearch(list,cpfn){var low=0;var high=list.length-1;while(low<=high){var mid=parseInt((low+high)/2);var cp=0;if(typeof cpfn==='function')cp=cpfn(list[mid]);else cp=cpfn-list[mid];if(cp===0)return mid;else if(cp>0)low=mid+1;else if(cp<0)high=mid-1;else return-1}};var settings={scale:1};(function(){var assetsHost='https://api-1256168079.cos.ap-chengdu.myqcloud.com';var iconHost='https://static.image.mihoyo.com/hsod2_webview/images/broadcast_top/equip_icon/png';var $=mdui.JQ;$('body').removeClass('mdui-drawer-body-left mdui-appbar-with-tab-larger').addClass('mdui-appbar-with-tab');new Vue({el:'#app',data:{tabs:{'\u5F53\u524D':'round','\u5386\u53F2\u6218\u7EE9':'history'},pet:{},round:{},history:{},pets:[],settings:settings},methods:{settab:function settab(tab){this.current.tab=tab},getPetImg:function getPetImg(id){return assetsHost+'/images/pet-run/'+id+'.png'},getPolygon:function getPolygon(pet){return(100-pet.Speed)/5+10+',30 '+('30, '+((100-pet.Satiety)/5+10)+' ')+((100+pet.Technique)/5+10+', 30 ')+('30, '+((100+pet.Energy)/5+10))},getTime:function getTime(stamp){var d=new Date(Number(stamp+'000'));return d.toLocaleDateString()+' '+d.toTimeString().split(' ')[0]},getShortTime:function getShortTime(stamp){var d=new Date(Number(stamp+'000'));return d.getDate()+'\u65E5'+d.getHours()+'\u65F6'},getPetDetail:function getPetDetail(id){var pos=BSearch(this.pets,function(item){return id-item.uid});if(pos===undefined||!this.pets[pos])return null;return this.pets[pos]},getPetIconImg:function getPetIconImg(id){var detail=this.getPetDetail(id);if(detail!==null&&detail.img){return iconHost+'/'+detail.img+'.png'}else return'/error.png'},showPetDetail:function showPetDetail(pet){this.pet=pet;this.$nextTick(function(){new mdui.Dialog('#pet-detail',{history:false}).open()})},showLoading:function showLoading(){$('#progress').css('opacity','1')},hideLoading:function hideLoading(){$('#progress').css('opacity','0')}},mounted:function mounted(){var _this=this;return _asyncToGenerator(regeneratorRuntime.mark(function _callee(){var pets,round,history;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/illustrate/v2/pet');case 2:pets=_context.sent;_this.pets=pets.data;round=axios.get('https://api.redbean.tech/pet-run/round.json').then(function(res){_this.round=res.data});history=axios.get('https://api.redbean.tech/pet-run/history.json').then(function(res){_this.history=res.data;_this.history.HistoryItemList=_this.history.HistoryItemList.map(function(item){if(item.PetGambleItemList&&item.PetGambleItemList.length){item.PetGambleItemList.sort(function(a,b){return a.Rank-b.Rank})}return item})});Promise.all([round,history]).then(_this.hideLoading);case 7:case'end':return _context.stop();}}},_callee,_this)}))()}});$('.hide').removeClass('hide')})();