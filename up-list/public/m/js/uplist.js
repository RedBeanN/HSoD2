'use strict';function tco(f){var value=void 0,active=false,accumulate=[];return function accumulator(){accumulate.push(arguments);if(!active){active=true;while(accumulate.length){value=f.apply(this,accumulate.shift())}active=false;return value}}}(function(){var $$=mdui.JQ;$$('#back-to-index').remove();$$('body').removeClass('mdui-drawer-body-left');function checkDumplicate(arr){var now=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var saved=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(arr.constructor!=Array)throw new Error('Type Error: input data is not an array.');if(now>=arr.length)return;if(!isContinous(arr[now],arr[saved]))return checkDumplicate(arr,now+1,now);if(spliceFrom(arr[now].data,arr[saved].data)){arr[saved].startTime=min(arr[saved].startTime,arr[now].startTime);arr[saved].endTime=max(arr[saved].endTime,arr[now].endTime)}else saved=now;now++;return checkDumplicate(arr,now,saved)}checkDumplicate=tco(checkDumplicate);var app=new Vue({el:'#app',data:{rows:[],pools:{'high':'\u516C\u4E3B','custom':'\u9B54\u5973','special':'\u9B54\u6CD5\u5C11\u5973','pet':'\u4F7F\u9B54'},searchInput:'',sortedFlag:true},computed:{filteredRows:function filteredRows(){var text=this.searchInput;return this.rows.filter(function(row){if(row.startTime.indexOf(text)!==-1||row.endTime.indexOf(text)!==-1)return true;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=row.data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var item=_step.value;if(item.indexOf(text)!==-1)return true}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return false})}},methods:{loadList:function loadList(pool,e){var _this=this;var self=this;showLoading();$$('.mdui-tab-active').removeClass('mdui-tab-active');$$(e.target).addClass('mdui-tab-active');axios.get('/list/auto/'+pool).then(function(res){_this.sortedFlag=true;var table=res.data.map(function(i){return{data:i.data,startTime:i.startTime.replace(/-/g,'/').split(' ')[0].substr(2),endTime:i.endTime.replace(/-/g,'/').split(' ')[0].substr(2)}});self.backToTop();if(pool==='high'||pool==='special')checkDumplicate(table);else if(pool==='pet')return self.loadPet(table);self.rows=table.filter(function(r){return r.data.length});self.sortTable();mdui.mutation('.mdui-table');hideLoading()})},loadPet:function loadPet(table){var self=this;axios.get('http://47.100.20.145:443/illustrate/pet-map').then(function(res){var map=res.data;self.rows=table.map(function(r){var data=[];r.data.forEach(function(d){return data.push(d,map[d]||'?')});r.data=data;return r});self.sortTable();mdui.mutation('.mdui-table');hideLoading()})},sortTable:function sortTable(){this.sortedFlag=!this.sortedFlag;var sortedFlag=this.sortedFlag;this.rows.sort(function(pre,now){var preTime=new Date('20'+pre.startTime);var nowTime=new Date('20'+now.startTime);return sortedFlag?preTime-nowTime:nowTime-preTime})},backToTop:function backToTop(){document.body.scrollTop=0;document.documentElement.scrollTop=0}},mounted:function mounted(){this.loadList('high',{target:$$('.pool-select')[0]});mdui.mutation()}});function showLoading(){$$('#progress').css('opacity',1)}function hideLoading(){$$('#progress').css('opacity',0)}function spliceFrom(a,b){if(a.constructor!=Array||b.constructor!=Array){throw new Error('Type Error: input datas are not arrays')}var isDumplicated=false;for(var i in a){for(var j in b){if(a[i]==b[j]){a.splice(i,1);isDumplicated=true}}}return isDumplicated}function min(da,db){return new Date('20'+da)<new Date('20'+db)?da:db}function max(da,db){return new Date('20'+da)>new Date('20'+db)?da:db}function isContinous(now,pre){var a=new Date('20'+now.startTime);var b=new Date('20'+pre.endTime);return a-b<=86400000}})();